# 筋トレ記録共有アプリ - 開発仕様書

## 1. プロジェクト概要

### アプリ名
筋トレ記録共有アプリ（仮称）

### プロジェクトの目的
友達と一緒に筋トレを頑張るため、筋トレの実績を記録し、コメントやいいね！で励まし合えるアプリを開発する。

### 解決したい課題
- 筋トレのモチベーション維持が難しい
- 一人では継続が困難
- 友達と一緒に応援し合える環境がない

---

## 2. アプリのゴール（WHO/WHAT/HOW）

### WHO（誰が使う？）
- **メインユーザー**: 筋トレを習慣化したい人
- **ターゲット**: 2〜3人の親しい友達グループ
- **ペルソナ**:
  - 筋トレを始めたばかり、または継続したい人
  - 友達と一緒に励まし合いながら成長したい人
  - スマホで手軽に記録を付けたい人

### WHAT（何を提供する？）
- 筋トレの記録を簡単に投稿できる機能
- 友達と記録を共有し、いいね・コメントで励まし合える機能
- 自分の成長を振り返れる機能（カレンダー、種目別記録）

### HOW（どのように実現する？）
- **スマホファースト**: 主にスマホで記録入力
- **マルチデバイス対応**: パソコンでも閲覧可能
- **シンプルなUI**: 初心者でも迷わず使える直感的な操作
- **クラウド同期**: どのデバイスからでもアクセス可能

---

## 3. ターゲットユーザー詳細

### ユーザー属性
- 年齢層: 20代〜40代
- 筋トレレベル: 初心者〜中級者
- 利用環境: 自宅トレーニング、ジム通い

### ユーザーのニーズ
1. **記録の継続**: 簡単に記録を付けられること
2. **モチベーション維持**: 友達の頑張りが見えて刺激を受けられること
3. **成長の実感**: 過去の記録を振り返って成長を感じられること
4. **コミュニケーション**: いいねやコメントで気軽に励まし合えること

### 利用シーン
- **記録時**: トレーニング中または直後にスマホで記録
- **閲覧時**: 通勤中や休憩時間にスマホで友達の投稿をチェック
- **振り返り時**: 自宅でパソコンやスマホで過去の記録を確認

---

## 4. 主要機能

### 4.1 MVP機能（最小限の実装）

#### フェーズ1: 基本機能
**優先度: 最高**

##### ユーザー認証
- ユーザー登録（メールアドレス、パスワード）
- ログイン/ログアウト
- パスワードリセット

##### 筋トレ記録投稿機能
- トレーニング部位の選択/入力
  - 例: 胸、脚、背中、肩、腕、腹筋など
- 種目名の入力
  - 例: 腕立て伏せ、スクワット、ベンチプレスなど
- 回数の入力（数値）
- セット数の入力（数値）
- 使用重量の入力（kg単位、任意）
- トレーニング日時の自動記録
- メモ・感想の入力（テキストエリア、任意）
- 写真の添付（1枚、任意）

##### 自分の記録一覧表示
- 日付降順での記録一覧
- 各記録の概要表示（部位、種目、日時）
- 記録の詳細表示（全情報）
- 記録の編集・削除機能

#### フェーズ2: 共有機能
**優先度: 高**

##### 友達との共有機能
- 自分の投稿を友達に公開
- 友達の投稿をタイムライン形式で閲覧
- 投稿の公開範囲設定（友達のみ）

##### いいね機能
- 投稿に対していいねを付ける/外す
- いいね数の表示
- 誰がいいねしたか確認

##### コメント機能
- 投稿に対してコメント投稿
- コメントの表示（時系列順）
- コメントの削除（自分のコメントのみ）

#### フェーズ3: 振り返り機能
**優先度: 中**

##### カレンダー表示
- 月次カレンダービュー
- トレーニング実施日のマーク表示
- 日付クリックで当日の記録表示

##### 種目ごとの記録表示
- 種目でフィルタリング
- 種目別の記録一覧（時系列順）
- 重量・回数の推移を確認

---

### 4.2 将来的に追加したい機能（MVP後）

#### 友達管理機能の拡張
- 友達招待機能（招待リンク、QRコード）
- 友達リクエスト承認/拒否
- 複数グループの作成・管理
- グループごとの投稿公開設定

#### データ可視化機能
- グラフ表示
  - 重量の推移グラフ（折れ線グラフ）
  - 回数の推移グラフ（折れ線グラフ）
  - トレーニング頻度グラフ（棒グラフ）
- 写真のビフォーアフター表示
  - 期間指定での写真比較
  - スライダーで変化を確認

#### その他の拡張機能
- 通知機能
  - 友達が投稿したらプッシュ通知
  - いいね・コメントの通知
- 目標設定機能
  - 週次/月次の目標設定
  - 目標達成率の表示
- トレーニングメニューのテンプレート保存
  - よく使う種目の組み合わせを保存
  - ワンタップで記録入力
- ストリーク機能
  - 連続トレーニング日数の表示
  - 継続のモチベーション向上

---

## 5. UI/UX方針

### デザイン原則
1. **シンプル・イズ・ベスト**: 必要最小限の情報と操作
2. **直感的な操作**: 説明不要で使える設計
3. **レスポンシブデザイン**: スマホ・タブレット・PCに対応
4. **高速なレスポンス**: ストレスのない操作感

### 画面構成
- **ホーム画面**: 自分と友達の投稿タイムライン
- **記録投稿画面**: フォーム形式でシンプルに入力
- **マイページ**: 自分の記録一覧、カレンダー、種目別記録
- **友達画面**: 友達リスト、友達の記録

### カラースキーム
- メインカラー: エネルギッシュで前向きな色（検討中）
- サブカラー: 落ち着いた補色
- アクセントカラー: いいねボタンなどのアクション

### アクセシビリティ
- 適切なコントラスト比
- タップしやすいボタンサイズ（44px以上）
- 分かりやすいエラーメッセージ

---

## 6. 技術仕様

### 6.1 アーキテクチャ

```
┌─────────────────┐
│   Frontend      │
│   (React)       │
└────────┬────────┘
         │ REST API
┌────────▼────────┐
│   Backend       │
│   (NestJS)      │
└────────┬────────┘
         │ Prisma ORM
┌────────▼────────┐
│   Database      │
│ (PostgreSQL)    │
└─────────────────┘
```

### 6.2 技術スタック

#### フロントエンド
- **フレームワーク**: React 18+
- **言語**: TypeScript
- **状態管理**: React Context API / React Query（検討中）
- **UIライブラリ**: Material-UI / Chakra UI（検討中）
- **ルーティング**: React Router v6
- **フォーム管理**: React Hook Form
- **バリデーション**: Zod / Yup
- **HTTPクライアント**: Axios
- **日付処理**: date-fns
- **画像処理**: react-image-crop（必要に応じて）

#### バックエンド
- **フレームワーク**: NestJS
- **言語**: TypeScript
- **ORM**: Prisma
- **認証**: Passport.js (JWT戦略)
- **バリデーション**: class-validator, class-transformer
- **ファイルアップロード**: Multer
- **API仕様**: REST API

#### データベース
- **RDBMS**: PostgreSQL 15+
- **実行環境**: Docker

#### インフラ（検討中）
- **ホスティング**: Vercel (Frontend) / Railway (Backend) / Render
- **ストレージ**: AWS S3 / Cloudinary（写真保存）
- **CI/CD**: GitHub Actions

### 6.3 データベース設計（初期案）

#### テーブル構成

**users（ユーザー）**
- id: UUID (PK)
- email: VARCHAR (UNIQUE)
- password_hash: VARCHAR
- username: VARCHAR
- profile_image_url: VARCHAR (nullable)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP

**workouts（筋トレ記録）**
- id: UUID (PK)
- user_id: UUID (FK → users)
- body_part: VARCHAR（部位）
- exercise_name: VARCHAR（種目名）
- sets: INTEGER
- reps: INTEGER
- weight: DECIMAL (nullable)
- memo: TEXT (nullable)
- image_url: VARCHAR (nullable)
- workout_date: TIMESTAMP
- created_at: TIMESTAMP
- updated_at: TIMESTAMP

**friendships（友達関係）**
- id: UUID (PK)
- user_id: UUID (FK → users)
- friend_id: UUID (FK → users)
- status: ENUM ('pending', 'accepted')（将来の拡張用）
- created_at: TIMESTAMP

**likes（いいね）**
- id: UUID (PK)
- workout_id: UUID (FK → workouts)
- user_id: UUID (FK → users)
- created_at: TIMESTAMP
- UNIQUE(workout_id, user_id)

**comments（コメント）**
- id: UUID (PK)
- workout_id: UUID (FK → workouts)
- user_id: UUID (FK → users)
- content: TEXT
- created_at: TIMESTAMP
- updated_at: TIMESTAMP

### 6.4 API設計（初期案）

#### 認証関連
- `POST /auth/register` - ユーザー登録
- `POST /auth/login` - ログイン
- `POST /auth/logout` - ログアウト
- `POST /auth/refresh` - トークン更新

#### ユーザー関連
- `GET /users/me` - 自分の情報取得
- `PUT /users/me` - 自分の情報更新
- `GET /users/:id` - ユーザー情報取得

#### 筋トレ記録関連
- `GET /workouts` - 記録一覧取得（自分+友達）
- `GET /workouts/me` - 自分の記録一覧取得
- `GET /workouts/:id` - 記録詳細取得
- `POST /workouts` - 記録投稿
- `PUT /workouts/:id` - 記録更新
- `DELETE /workouts/:id` - 記録削除

#### いいね関連
- `POST /workouts/:id/likes` - いいね追加
- `DELETE /workouts/:id/likes` - いいね削除
- `GET /workouts/:id/likes` - いいね一覧取得

#### コメント関連
- `GET /workouts/:id/comments` - コメント一覧取得
- `POST /workouts/:id/comments` - コメント投稿
- `DELETE /comments/:id` - コメント削除

#### 友達関連（将来実装）
- `GET /friends` - 友達一覧取得
- `POST /friends/invite` - 友達招待
- `POST /friends/:id/accept` - 友達承認

### 6.5 セキュリティ要件

- パスワードのハッシュ化（bcrypt）
- JWTトークンによる認証
- HTTPS通信の強制
- CORS設定
- SQLインジェクション対策（Prisma使用）
- XSS対策（入力値のサニタイゼーション）
- CSRF対策
- レート制限（API呼び出し頻度制限）

---

## 7. 開発ロードマップ

### スプリント1: 環境構築・基本設計（1週間）
- [ ] 開発環境のセットアップ
  - [ ] Dockerでの PostgreSQL環境構築
  - [ ] NestJSプロジェクト初期化
  - [ ] Reactプロジェクト初期化
  - [ ] Prismaセットアップ
- [ ] データベーススキーマ設計・実装
- [ ] 基本的なAPI構造の構築

### スプリント2: 認証機能（1週間）
- [ ] ユーザー登録機能
- [ ] ログイン機能
- [ ] JWT認証の実装
- [ ] フロントエンド: 認証画面の実装

### スプリント3: 筋トレ記録機能（2週間）
- [ ] バックエンド: 記録CRUD API実装
- [ ] 画像アップロード機能
- [ ] フロントエンド: 記録投稿フォーム
- [ ] フロントエンド: 記録一覧表示
- [ ] フロントエンド: 記録詳細表示

### スプリント4: 共有機能（1.5週間）
- [ ] バックエンド: いいね機能API
- [ ] バックエンド: コメント機能API
- [ ] フロントエンド: タイムライン実装
- [ ] フロントエンド: いいねボタン実装
- [ ] フロントエンド: コメント機能実装

### スプリント5: 振り返り機能（1.5週間）
- [ ] バックエンド: カレンダー用API
- [ ] バックエンド: 種目別フィルタAPI
- [ ] フロントエンド: カレンダービュー実装
- [ ] フロントエンド: 種目別記録表示

### スプリント6: テスト・改善（1週間）
- [ ] ユニットテスト実装
- [ ] 統合テスト実装
- [ ] E2Eテスト（主要フロー）
- [ ] バグフィックス
- [ ] パフォーマンス最適化

### スプリント7: デプロイ・リリース（1週間）
- [ ] 本番環境構築
- [ ] デプロイ設定
- [ ] 本番データベースセットアップ
- [ ] リリース準備
- [ ] MVP版リリース

**総期間: 約8〜9週間**

---

## 8. 成功基準

### MVP完成時の定義
以下の機能がすべて動作すること：
1. ✅ ユーザー登録・ログインができる
2. ✅ 筋トレ記録を投稿できる（写真含む）
3. ✅ 自分の記録一覧が見られる
4. ✅ 友達の投稿が見られる
5. ✅ いいね・コメントができる
6. ✅ カレンダーで記録を確認できる
7. ✅ 種目別に記録を確認できる
8. ✅ スマホ・PCの両方で使える

### 品質基準
- ページ読み込み時間: 3秒以内
- API レスポンスタイム: 500ms以内
- モバイル対応: レスポンシブデザイン
- ブラウザ対応: Chrome, Safari, Firefox最新版
- バグ: クリティカルなバグがゼロ

### ユーザー満足度
- 実際に2〜3人の友達グループで1ヶ月使用
- 週3回以上の継続利用
- 友達とのエンゲージメント（いいね・コメント）が発生

### ビジネス指標（将来的に）
- ユーザー登録数
- 日次アクティブユーザー（DAU）
- 記録投稿頻度
- ユーザー継続率（1ヶ月後、3ヶ月後）

---

## 9. リスクと対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 画像アップロードの容量問題 | 中 | 画像圧縮、ストレージ容量監視 |
| データベースパフォーマンス | 低 | 適切なインデックス設計、クエリ最適化 |
| セキュリティ脆弱性 | 高 | 定期的なライブラリ更新、セキュリティレビュー |

### プロジェクトリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| スケジュール遅延 | 中 | スプリント単位での進捗管理、MVP機能の厳選 |
| スコープクリープ | 中 | MVP機能の明確化、将来機能は後回し |
| 技術選定ミス | 中 | 早期のプロトタイプ検証 |

---

## 10. 開発ルール

### コーディング規約
- TypeScriptの厳格モード使用
- ESLint/Prettierによる自動フォーマット
- 意味のある変数名・関数名
- コメントは必要最小限（コードで表現できることは書かない）

### Git運用
- mainブランチは常にデプロイ可能な状態を保つ
- 機能開発はfeatureブランチで実施
- コミットメッセージは明確に（Conventional Commits推奨）
- プルリクエストでのコードレビュー

### ドキュメント
- このCLAUDE.mdを随時更新
- API仕様はSwagger/OpenAPIで管理
- 重要な設計決定は記録

---

## 11. 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|----------|--------|
| 2025-12-06 | 初版作成 | - |

---

## 12. 参考リンク

### 技術ドキュメント
- [React公式ドキュメント](https://react.dev/)
- [NestJS公式ドキュメント](https://docs.nestjs.com/)
- [Prisma公式ドキュメント](https://www.prisma.io/docs)
- [PostgreSQL公式ドキュメント](https://www.postgresql.org/docs/)

### 開発ツール
- GitHub Repository: （未定）
- プロジェクト管理: （未定）
- デザインツール: （未定）

---

**このドキュメントは開発の進行に合わせて随時更新してください。**
